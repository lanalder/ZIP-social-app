/*! frontend 2021-09-23 */

$(document).ready(function(){let r,o=new Array(4),n={};const a=["username","password","profl_pic","email"];$.ajax({url:"config.json",type:"GET",dataType:"json",success(e){r=`${e.SERVER_URL}:${e.SERVER_PORT}`,s()},error(e){console.log(e)}});const l=r=>{for(let e=0;e<r;e++)console.log(o[e],e),Object.defineProperty(n,a[e],{value:o[e],enumerable:!0,configurable:!0})},t=e=>{sessionStorage.clear(),sessionStorage.setItem("user_id",e._id),sessionStorage.setItem("username",e.username)},s=()=>{document.querySelector(".reg-btn").addEventListener("click",function(e){e.preventDefault(),Array.from(document.querySelectorAll(".newUser")).forEach((e,r)=>{o[r]=$(e).val()}),l(4),console.log(n),o.every(e=>e)?$.ajax({url:`${r}/newUser`,type:"POST",data:JSON.stringify(n),contentType:"application/json",success(e){console.log(e),"username taken already. pls use a different username."!==e?(alert("registered! and auto. logged in :)"),t(e),window.location.href="index.html"):alert("username already taken..."),Array.from(document.querySelectorAll(".newUser")).forEach((e,r)=>{$(e).val("")})},error(){console.log("error: cannot call api")}}):alert("pls enter all details")},!1),document.querySelector(".login-btn").addEventListener("click",function(e){e.preventDefault(),o[0]=$("#loginUsername").val(),o[1]=$("#loginPassword").val(),l(2),console.log(n),""==o[0]||""==o[1]?alert("pls enter all details thx xx"):$.ajax({url:`${r}/loginUser`,type:"POST",data:JSON.stringify(n),contentType:"application/json",success(e){"user not found. please register :)"==e?alert("Username does not exist. Please register"):"not authorised"==e?alert("Incorrect Details. Please try again."):(t(e),alert("You are now logged in"),$("#loginUsername").val(""),$("#loginPassword").val(""),window.location.href="index.html")},error(){console.log("error: cannot call api")}})},!1)}});