/*! frontend 2021-09-23 */

$(document).ready(function(){let r,n=new Array(4),a={};const o=["username","password","profl_pic","email"];$.ajax({url:"config.json",type:"GET",dataType:"json",success(e){r=`${e.SERVER_URL}:${e.SERVER_PORT}`,s()},error(e){console.log(e)}});const t=r=>{for(let e=0;e<r;e++)console.log(n[e],e),Object.defineProperty(a,o[e],{value:n[e],enumerable:!0,configurable:!0})},l=e=>{sessionStorage.clear(),sessionStorage.setItem("user_id",e._id),sessionStorage.setItem("username",e.username)},s=()=>{document.querySelector(".reg-btn").addEventListener("click",function(e){e.preventDefault(),Array.from(document.querySelectorAll(".newUser")).forEach((e,r)=>{n[r]=$(e).val()}),t(4),n.every(e=>e)?$.ajax({url:`${r}/newUser`,type:"POST",data:JSON.stringify(a),contentType:"application/json",success(e){"username taken already. pls use a different username."!==e?(alert("registered! and auto. logged in :)"),l(e),window.location.href="index.html"):alert("username already taken..."),Array.from(document.querySelectorAll(".newUser")).forEach((e,r)=>{$(e).val("")})},error(){console.log("error: cannot call api")}}):alert("pls enter all details")},!1),document.querySelector(".login-btn").addEventListener("click",function(e){e.preventDefault(),n[0]=$("#loginUsername").val(),n[1]=$("#loginPassword").val(),t(2),console.log(a),""==n[0]||""==n[1]?alert("pls enter all details thx xx"):$.ajax({url:`${r}/loginUser`,type:"POST",data:JSON.stringify(a),contentType:"application/json",success(e){"user not found. please register :)"==e?alert("Username does not exist. Please register"):"not authorised"==e?alert("Incorrect Details. Please try again."):(l(e),alert("You are now logged in"),$("#loginUsername").val(""),$("#loginPassword").val(""),window.location.href="index.html")},error(){console.log("error: cannot call api")}})},!1)}});