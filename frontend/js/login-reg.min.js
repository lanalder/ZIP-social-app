/*! frontend 2021-09-20 */

$(document).ready(function(){let r,a=new Array(4),n={};const o=["email","profl_pic","username","password"];$.ajax({url:"config.json",type:"GET",dataType:"json",success(e){r=`${e.SERVER_URL}:${e.SERVER_PORT}`,s()},error(e){console.log(e)}});const t=r=>{for(let e=r;e<4;e++)Object.defineProperty(n,o[e],{value:a[e],enumerable:!0,configurable:!0})},l=e=>{sessionStorage.clear(),sessionStorage.setItem("user_id",e._id),sessionStorage.setItem("username",e.username)},s=()=>{document.querySelector(".reg-btn").addEventListener("click",function(e){e.preventDefault(),Array.from(document.querySelectorAll(".newUser")).forEach((e,r)=>{a[r]=$(e).val()}),t(0),console.log(n),a.every(e=>e)?$.ajax({url:`${r}/newUser`,type:"POST",data:JSON.stringify(n),contentType:"application/json",success(e){console.log(e),"username taken already. pls use a different username."!==e?(alert("registered! and auto. logged in :)"),l(e)):alert("username already taken..."),Array.from(document.querySelectorAll(".newUser")).forEach((e,r)=>{$(e).val("")})},error(){console.log("error: cannot call api")}}):alert("pls enter all details")},!1),document.querySelector(".login-btn").addEventListener("click",function(e){e.preventDefault(),a[2]=$("#loginUsername").val(),a[3]=$("#loginPassword").val(),t(2),""==a[1]||""==a[2]?alert("pls enter all details thx xx"):$.ajax({url:`${r}/loginUser`,type:"POST",data:JSON.stringify(n),contentType:"application/json",success(e){"user not found. please register :)"==e?alert("Username does not exist. Please register"):"not authorised"==e?alert("Incorrect Details. Please try again."):(l(e),alert("You are now logged in"),$("#loginUsername").val(""),$("#loginPassword").val(""),window.location.href="index.html")},error(){console.log("error: cannot call api")}})},!1)}});