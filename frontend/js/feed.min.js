/*! frontend 2021-09-16 */

$(document).ready(function(){let a,s=void new Array(6);$.ajax({url:"config.json",type:"GET",dataType:"json",success(e){a=`${e.SERVER_URL}:${e.SERVER_PORT}`,t()},error(e){console.log(e)}});const i=e=>{console.log(e),$.ajax({url:`${a}/seeComments/${s}`,type:"GET",dataType:"json",context:e.parentElement.parentElement.parentElement,success(t){for(let e=0;e<t.length;e++){var a=t[e];this.innerHTML+=`
          <div class="comment-container border-bottom">
            <h6 class="comment-username">${a.author}</h6>
            <p class="comment-text">${a.text}</p>
            <p class="comment-time">${a.time}</p>
          </div>`}this.innerHTML+=`
        <div class="form-group mb-3">
          <label for="newComment" class="form-label new-comment-label">
            <h6>Post New Comment</h6>
          </label>
          <textarea class="form-control" id="newComment" rows="3" maxlength="160" placeholder="Maximum 160 Characters"></textarea>
          <p class="text-end send-comment-btn"><i class="fa fa-paper-plane text-end" aria-hidden="true"></i></p>
        </div>`},error(e){console.log(e)}})},o=t=>{sessionStorage.getItem("user_id")?$.ajax({url:`${a}/likePost/${s}`,type:"POST",data:{user_id:sessionStorage.getItem("user_id")},dataType:"json"}).done(e=>{console.dir(t),t.firstChild.classList.remove("fa-heart-o"),t.firstChild.classList.add("fa-heart"),t.firstChild.classList.toggle("active-icon")}):alert("Please login or register to interact with posts :)")},t=()=>{$.ajax({url:`${a}/allPosts`,type:"GET",dataType:"json",context:document.querySelector("#albumOutput"),success(t){this.innerHTML="";for(let e=t.length-1;0<=e;--e){var a=t[e];this.innerHTML+=`<div class="col-md-4">
              <div class="card mb-4">
                <img class="card-img-top" src="${a.img_url}" alt="" style="width: 100%">
                <div class="card-img-overlay d-flex">
                  <div class="expand-container text-wrap">
                    <i class="fa fa-expand ${a._id}" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#viewFullImageModal"></i>
                  </div>
                  <div class="col-8 overlay-container d-flex justify-content-center">
                    <img class="rounded-circle overlay-profile-image" src="${a.author[0].profl_pic}" alt="" width="50" height="50">
                    <div class="overlay-text-container">
                      <h4 class="overlay-username d-block">${a.author[0].username}</h4>
                      <p class="overlay-imagename d-block">${a.title}</p>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="like-comment-container d-flex justify-content-between">

                    <p class="${a._id} like interaction-icon like-counter interaction-icon"><i class="${a._id} fa fa-heart-o like" aria-hidden="true"></i> ${a.stats.likes.length}</p>

                    <p class="${a._id} comment interaction-icon comment-counter interaction-icon"><i class="${a._id} comment fa fa-commenting-o" aria-hidden="true"></i> ${a.stats.comments}</p>

                    <p class="${a._id} edit interaction-icon"><i class="${a._id} edit fa fa-pencil" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#editModal"></i></p>

                    <p class="${a._id} delete interaction-icon"><i class="${a._id} delete fa fa-trash-o" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#deleteModal"></i></p>

                  </div>
                  <p class="card-text">${a.descript}</p>
                  <div class="comments-output">
                  </div>
                </div>
              </div>
            </div>`}Array.from(document.querySelectorAll(".interaction-icon")).forEach(t=>{t.addEventListener("click",function(e){s=e.target.classList[0],e.target.classList.contains("comment")?(console.log("c"),i(t)):e.target.classList.contains("like")&&(console.log("l"),o(t))},!1)})}})}});