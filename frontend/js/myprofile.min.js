/*! frontend 2021-09-16 */

$(document).ready(function(){const e=document.querySelector(".comment-counter"),t=document.querySelector(".comments-output");e.addEventListener("click",function(){t.classList.toggle("display-none")});let a,o=new Array(6),s={},r;const l=["title","descript","img_url","user_id","author"];$.ajax({url:"config.json",type:"GET",dataType:"json",success(e){a=`${e.SERVER_URL}:${e.SERVER_PORT}`,o[4]=sessionStorage.getItem("user_id"),o[5]=sessionStorage.getItem("author"),c()},error(e){console.log(e)}});const n=()=>sessionStorage.getItem("user_id")?o.every(e=>e):(alert("Please login to perform this action"),!1),i=()=>{for(let e=0;e<6;e++)Object.defineProperty(s,l[e],{value:o[e],enumerable:!0,configurable:!0})},c=()=>{$.ajax({url:`${a}/allPosts`,type:"GET",dataType:"json",success(t){document.querySelector("#albumOutput").innerHTML="";window.location.hash.substring(1).replace(/(-)/," ");for(let e=t.length-1;0<=e;--e){var a=t[e];document.querySelector("#albumOutput").innerHTML+=`<div class="col-md-4">
              <div class="card mb-4">
                <img class="card-img-top" src="${a.img_url}" alt="" style="width: 100%">
                <div class="card-img-overlay d-flex">
                  <div class="expand-container text-wrap">
                    <i class="fa fa-expand ${a._id}" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#viewFullImageModal"></i>
                  </div>
                  <div class="col-8 overlay-container d-flex justify-content-center">
                    <img class="rounded-circle overlay-profile-image" src="${user.profl_pic}" alt="" width="50" height="50">
                    <div class="overlay-text-container">
                      <h4 class="overlay-username d-block">${user.username}</h4>
                      <p class="overlay-imagename d-block">${a.title}</p>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="like-comment-container d-flex justify-content-between">
                    <p class="like-counter interaction-icon"><i class="fa fa-heart-o ${a._id}" aria-hidden="true"></i> ${a.stats.likes.length}</p>
                    <p class="comment-counter interaction-icon"><i class="fa fa-commenting-o ${a._id}" aria-hidden="true"></i> ${a.stats.comments}</p>
                    <p class="interaction-icon"><i class="fa fa-pencil ${a._id}" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#editModal"></i></p>
                    <p class="interaction-icon"><i class="fa fa-trash-o ${a._id}" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#deleteModal"></i></p>
                  </div>
                  <p class="card-text">${a.descript}</p>
                  <div class="comments-output display-none">
                    <div class="form-group mb-3">
                      <label for="newComment" class="form-label new-comment-label">
                        <h6>Post New Comment</h6>
                      </label>
                      <textarea class="form-control" id="newComment" rows="3" maxlength="160" placeholder="Maximum 160 Characters"></textarea>
                      <p class="text-end send-comment-btn"><i class="fa fa-paper-plane text-end" aria-hidden="true"></i></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>`}},error(e){console.log(e)}})};document.querySelector("#addPostBtn").addEventListener("click",function(e){Array.from(document.querySelectorAll(".add")).forEach((e,t)=>{o[t]=$(e).val()}),i(),console.log(s),n()?$.ajax({url:`${a}/postPost`,type:"POST",data:JSON.stringify(s),contentType:"application/json",success(e){alert("Your project has been successfully added!"),window.location.reload()},error(e){alert("You are not authorised to perform this action")}}):alert("Please fill out all fields")},!1),document.querySelector("#editConfirmBtn").addEventListener("click",function(e){Array.from(document.querySelectorAll(".edit")).forEach((e,t)=>{o[t]=$(e).val()}),i(),n()?$.ajax({url:`${a}/editPost/${r}`,type:"PATCH",data:JSON.stringify(s),contentType:"application/json",success(e){"401: user has no permission to update"==e?alert(e):(alert("Post has been updated"),window.location.reload())},error(){console.log("error: cannot call api")}}):alert("Please fill in all fields")},!1),document.querySelector("#deleteConfirmBtn").addEventListener("click",function(e){sessionStorage.getItem("user_id")?$.ajax({url:`${a}/deletePost/${r}`,type:"DELETE",data:{user_id:sessionStorage.getItem("user_id")},success(e){"deleted"==e?(alert("Post has been deleted"),window.location.reload()):console.log("Post was not found")},error(){console.log("error: cannot call api")}}):alert("permission denied")},!1)});