/*! frontend 2021-09-15 */

$(document).ready(function(){const e=document.querySelector(".comment-counter"),t=document.querySelector(".comments-output");e.addEventListener("click",function(){t.classList.toggle("display-none"),e.classList.toggle("comments-expanded")});let o,r=new Array(6),n={},a;const l=["projectName","image_url","authorName","projectURL","description","userId"];$.ajax({url:"config.json",type:"GET",dataType:"json",success(e){o=`${e.SERVER_URL}:${e.SERVER_PORT}`,r[5]=sessionStorage.getItem("userID"),d()},error(e){console.log(e)}});const c=()=>sessionStorage.getItem("userID")?r.every(e=>e):(alert("u must b logged in to do this :/"),!1),s=()=>{for(let e=0;e<6;e++)Object.defineProperty(n,l[e],{value:r[e],enumerable:!0,configurable:!0})},d=()=>{$.ajax({url:`${o}/allProjects`,type:"GET",dataType:"json",success(t){document.querySelector("#albumOutput").innerHTML="";var o=window.location.hash.substring(1).replace(/(-)/," ");for(let e=t.length-1;0<=e;--e)o!==t[e].authorName&&""!=window.location.hash||(window.location.hash?document.querySelector("#albumHeader").innerHTML=o:document.querySelector("#albumHeader").innerHTML="All Projects",document.querySelector("#albumOutput").innerHTML+="");informedModal()},error(e){console.log(e)}})};document.querySelector("#modalAddBtn").addEventListener("click",function(e){Array.from(document.querySelectorAll(".add")).forEach((e,t)=>{r[t]=$(e).val()}),s(),console.log(n),c()?$.ajax({url:`${o}/addProject`,type:"POST",data:JSON.stringify(n),contentType:"application/json",success(e){alert("project added"),window.location.reload()},error(e){alert("sorry, u r not the authorised author")}}):alert("pls enter every field")},!1),document.querySelector("#modalSaveBtn").addEventListener("click",function(e){Array.from(document.querySelectorAll(".edit")).forEach((e,t)=>{r[t]=$(e).val()}),s(),c()?$.ajax({url:`${o}/update/${a}`,type:"PATCH",data:JSON.stringify(n),contentType:"application/json",success(e){"401: user has no permission to update"==e?alert(e):(alert("updated"),window.location.reload())},error(){console.log("error: cannot call api")}}):alert("pls enter every field")},!1),document.querySelector("#deleteConfirmBtn").addEventListener("click",function(e){sessionStorage.getItem("userID")?$.ajax({url:`${o}/delete/${a}`,type:"DELETE",data:{userId:sessionStorage.getItem("userID")},success(e){"deleted"==e?(alert("deleted"),window.location.reload()):alert("invalid id")},error(){console.log("error: cannot call api")}}):alert("permission denied")},!1)});